# SURGICAL UPDATES FOR openweather_fields.yaml
# Add unit conversion specifications for data-driven unit handling

# ============================================================================
# 1. ADD NEW SECTION - Add this at the very top of the YAML file
#    Location: Add as the first section in openweather_fields.yaml
# ============================================================================

# Unit conversion definitions for data-driven unit handling
unit_conversions:
  # Wind speed conversions - only needed when WeeWX METRIC + OpenWeather metric
  wind_speed_m_s_to_km_h:
    description: "Convert OpenWeather m/s to WeeWX METRIC km/hr"
    from_unit: "m/s"
    to_unit: "km/hr"
    formula: "x * 3.6"
    applies_when:
      weewx_system: "METRIC"
      openweather_units: "metric"
    
  # Future conversions can be easily added here
  # Example: pressure conversions if needed
  # pressure_hpa_to_inhg:
  #   description: "Convert hPa to inHg"
  #   from_unit: "hPa"  
  #   to_unit: "inHg"
  #   formula: "x * 0.02953"

# ============================================================================
# 2. UPDATE EXISTING FIELD - Modify the ow_wind_speed field definition
#    Location: Find the ow_wind_speed field in current_weather section and replace it
# ============================================================================

      ow_wind_speed:
        display_name: "Wind speed"
        database_field: "ow_wind_speed"
        database_type: "REAL"
        api_path: "wind.speed"
        service_field: "wind_speed"
        complexity_levels: ["minimal", "all"]
        unit_conversion: "wind_speed_m_s_to_km_h"  # Reference to conversion above

# ============================================================================
# 3. UPDATE EXISTING FIELD - Modify the ow_wind_gust field definition  
#    Location: Find the ow_wind_gust field in current_weather section and replace it
# ============================================================================

      ow_wind_gust:
        display_name: "Wind gusts"
        database_field: "ow_wind_gust"
        database_type: "REAL"
        api_path: "wind.gust"
        service_field: "wind_gust"
        complexity_levels: ["all"]
        unit_conversion: "wind_speed_m_s_to_km_h"  # Same conversion for gusts

# ============================================================================
# 4. ADD NEW FIELDS - Add these UV fields to support Extension 3 health predictions
#    Location: Add a new uv_index module section after the air_quality section
# ============================================================================

  uv_index:
    display_name: "UV Index Data" 
    description: "UV radiation levels and solar exposure for health predictions"
    api_url: "http://api.openweathermap.org/data/2.5/uvi"
    recommended_interval: 3600  # 1 hour
    service_name: "uv_index"
    
    fields:
      ow_uv_current:
        display_name: "Current UV index"
        database_field: "ow_uv_current"
        database_type: "REAL"
        api_path: "value"
        service_field: "uv_current"
        complexity_levels: ["minimal", "all"]  # Essential for health predictions
        
      ow_uv_max_today:
        display_name: "Daily maximum UV index"
        database_field: "ow_uv_max_today"
        database_type: "REAL"
        api_path: "value"  # Would need daily endpoint for max
        service_field: "uv_max_today"
        complexity_levels: ["all"]  # Not essential, but useful

# ============================================================================
# 5. UPDATE COMPLEXITY DEFINITIONS - Replace existing complexity_definitions section
#    Location: Find and replace the existing complexity_definitions section at the end
# ============================================================================

# Complexity level definitions for reference
complexity_definitions:
  minimal:
    description: "Essential fields for Extension 3 health predictions"
    target_field_count: 17  # Updated count with UV fields
    includes: "Temperature, humidity, pressure, wind, air quality, UV index"
    
  all:
    description: "All available OpenWeather fields"
    target_field_count: 29  # Updated total count
    includes: "All minimal fields plus weather descriptions, precipitation, extremes"
    
  custom:
    description: "User-selected specific fields"
    includes: "Interactive selection from all available fields"

# ============================================================================
# 6. ADD NEW SECTION - Add API endpoints metadata for service configuration
#    Location: Add this new section after complexity_definitions
# ============================================================================

# API endpoint configuration for automatic service setup
api_endpoints:
  free_apis:
    - current_weather
    - air_quality
    - uv_index
  
  paid_apis: []  # Future: one_call, forecasts, historical
  
  rate_limits:
    current_weather: 60  # calls per minute
    air_quality: 60
    uv_index: 60
  
  unit_parameters:
    current_weather: "units"  # API parameter name for unit system
    air_quality: null        # Air quality doesn't use units parameter
    uv_index: null           # UV index doesn't use units parameter